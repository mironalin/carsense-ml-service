2025-05-13 10:39:15,997 - INFO - --- Starting Tier 1 Anomaly Model Testing (with Combined General Model) ---
2025-05-13 10:39:15,998 - INFO - Loading model from: /home/alinmiron/ZedProjects/carsense-ml-service/models/anomaly/tier1_combined_general_isolation_forest.joblib
2025-05-13 10:39:16,020 - INFO - Loading scaler from: /home/alinmiron/ZedProjects/carsense-ml-service/models/anomaly/tier1_combined_general_scaler.joblib
2025-05-13 10:39:16,021 - INFO - Loading imputer from: /home/alinmiron/ZedProjects/carsense-ml-service/models/anomaly/tier1_combined_general_imputer.joblib
2025-05-13 10:39:16,023 - INFO - Model, scaler, and imputer loaded successfully.
2025-05-13 10:39:16,023 - INFO - Scaler was trained on features: ['ENGINE_RPM', 'ENGINE_COOLANT_TEMP', 'INTAKE_AIR_TEMP', 'THROTTLE_POS', 'VEHICLE_SPEED', 'ENGINE_LOAD']
2025-05-13 10:39:16,023 - INFO - Loading testing data from: /home/alinmiron/ZedProjects/carsense-ml-service/data/model_input/volvo_v40_renamed_raw_pids_for_tier1_test.parquet
2025-05-13 10:39:16,126 - INFO - Successfully loaded data with shape: (242385, 19)
2025-05-13 10:39:16,126 - INFO - Preprocessing data for prediction (is_prescaled=False)...
2025-05-13 10:39:16,145 - INFO - Applying imputer to features: ['ENGINE_RPM', 'ENGINE_COOLANT_TEMP', 'INTAKE_AIR_TEMP', 'THROTTLE_POS', 'VEHICLE_SPEED', 'ENGINE_LOAD']
2025-05-13 10:39:16,188 - INFO - Imputer handled 53374 NaN values in column 'ENGINE_RPM'.
2025-05-13 10:39:16,189 - INFO - Imputer handled 198141 NaN values in column 'ENGINE_COOLANT_TEMP'.
2025-05-13 10:39:16,190 - INFO - Imputer handled 217909 NaN values in column 'INTAKE_AIR_TEMP'.
2025-05-13 10:39:16,190 - INFO - Imputer handled 60986 NaN values in column 'THROTTLE_POS'.
2025-05-13 10:39:16,191 - INFO - Imputer handled 1 NaN values in column 'VEHICLE_SPEED'.
2025-05-13 10:39:16,192 - INFO - Imputer handled 207011 NaN values in column 'ENGINE_LOAD'.
2025-05-13 10:39:16,192 - INFO - Imputation complete.
2025-05-13 10:39:16,199 - INFO - Scaling features: ['ENGINE_RPM', 'ENGINE_COOLANT_TEMP', 'INTAKE_AIR_TEMP', 'THROTTLE_POS', 'VEHICLE_SPEED', 'ENGINE_LOAD']
2025-05-13 10:39:16,208 - INFO - Scaling complete.
2025-05-13 10:39:16,208 - INFO - Predicting anomalies using the loaded model...
2025-05-13 10:39:16,921 - INFO - Prediction complete. Found 26421 anomalies out of 242385 samples (10.90%).
2025-05-13 10:39:16,933 - INFO - Extracted 26421 anomalous rows for analysis.
2025-05-13 10:39:16,956 - INFO - Running heuristic analysis on anomalous data points...
2025-05-13 10:39:16,956 - INFO - Starting anomaly analysis for 26421 anomalies...
2025-05-13 10:39:16,956 - WARNING - Skipping Low Voltage analysis: Column 'CONTROL_MODULE_VOLTAGE' not found.
2025-05-13 10:39:16,966 - INFO - Low ENGINE_COOLANT_TEMP Heuristic (Runtime > 120s): Found 12017 anomalies below scaled threshold -1.50. Insight added.
2025-05-13 10:39:16,972 - INFO - High RPM / Low Speed Heuristic: Found 0 anomalies matching criteria. Insight added.
2025-05-13 10:39:16,976 - INFO - High Load / Low RPM Heuristic: Found 0 anomalies matching criteria. Insight added.
2025-05-13 10:39:16,981 - INFO - High TPS / Low Load Heuristic: Found 1104 anomalies matching criteria. Insight added.
2025-05-13 10:39:16,987 - INFO - High IAT Heuristic: Found 5215 anomalies matching criteria. Insight added.
2025-05-13 10:39:16,997 - INFO - Coolant vs IAT Heuristic (Runtime > 120s): Found 15301 anomalies. Insight added.
2025-05-13 10:39:17,005 - INFO - Low Load / High Speed Heuristic: Found 516 anomalies matching criteria. Insight added.
2025-05-13 10:39:17,036 - INFO - Anomaly analysis finished.
2025-05-13 10:39:17,037 - INFO - --- Anomaly Analysis Results ---
2025-05-13 10:39:17,037 - INFO - {
  "total_anomalies": 26421,
  "low_voltage_analysis": {
    "skipped": "Column 'CONTROL_MODULE_VOLTAGE' not found."
  },
  "low_coolant_analysis": {
    "threshold_scaled": -1.5,
    "count_after_warmup": 12017,
    "runtime_filter_sec": 120,
    "insight": "Detected anomalies exhibiting patterns consistent with low ENGINE_COOLANT_TEMP (scaled < -1.5) after expected warmup period. Possible thermostat or sensor issue."
  },
  "high_rpm_low_speed_analysis": {
    "rpm_threshold_scaled": 1.5,
    "speed_threshold_scaled": -0.5,
    "count": 0,
    "insight": "Detected anomalies exhibiting patterns consistent with high ENGINE_RPM (scaled > 1.5) at very low VEHICLE_SPEED (scaled < -0.5). Possible clutch/transmission issue or sensor error."
  },
  "high_load_low_rpm_analysis": {
    "load_threshold_scaled": 0.75,
    "rpm_threshold_scaled": -0.5,
    "count": 0,
    "insight": "Detected anomalies consistent with high ENGINE_LOAD (scaled > 0.75) at low ENGINE_RPM (scaled < -0.5). Possible engine lugging or sensor issue."
  },
  "high_tps_low_load_analysis": {
    "tps_threshold_scaled": 0.75,
    "load_threshold_scaled": 0.0,
    "count": 1104,
    "insight": "Detected anomalies consistent with high THROTTLE_POS (scaled > 0.75) but low ENGINE_LOAD (scaled < 0.0). Possible throttle/load sensor mismatch or other performance issue."
  },
  "high_iat_analysis": {
    "iat_threshold_scaled": 2.0,
    "count": 5215,
    "insight": "Detected anomalies consistent with unusually high INTAKE_AIR_TEMP (scaled > 2.0). Possible sensor issue or heat soak condition."
  },
  "coolant_vs_iat_analysis": {
    "diff_threshold_scaled": 0.5,
    "count_after_warmup": 15301,
    "runtime_filter_sec": 120,
    "insight": "Detected anomalies where scaled ENGINE_COOLANT_TEMP (< INTAKE_AIR_TEMP + 0.5) is not significantly higher than scaled INTAKE_AIR_TEMP after expected warmup. Possible coolant sensor or thermostat issue."
  },
  "low_load_high_speed_analysis": {
    "speed_threshold_scaled": 1.5,
    "load_threshold_scaled": 0.05,
    "count": 516,
    "insight": "Detected anomalies consistent with very low ENGINE_LOAD (scaled < 0.05) at high VEHICLE_SPEED (scaled > 1.5). Possible sensor issue or coasting condition."
  },
  "anomaly_stats_original_values": {
    "ENGINE_RPM": {
      "count": 26421.0,
      "mean": 2527.744536384044,
      "std": 2917.502524275657,
      "min": 0.0,
      "25%": 1231.2,
      "50%": 1381.0,
      "75%": 1815.0,
      "max": 15205.0
    },
    "ENGINE_COOLANT_TEMP": {
      "count": 25078.0,
      "mean": 59.52072403365568,
      "std": 30.335024148948012,
      "min": -28.0,
      "25%": 26.0,
      "50%": 78.0,
      "75%": 88.5,
      "max": 197.0
    },
    "INTAKE_AIR_TEMP": {
      "count": 20558.0,
      "mean": 30.953867918409703,
      "std": 34.21515011124352,
      "min": -28.0,
      "25%": 9.0,
      "50%": 11.0,
      "75%": 88.5,
      "max": 197.0
    },
    "THROTTLE_POS": {
      "count": 26414.0,
      "mean": 21.303871618762898,
      "std": 16.47409108097044,
      "min": 4.0,
      "25%": 8.25,
      "50%": 15.0,
      "75%": 26.25,
      "max": 92.0
    },
    "VEHICLE_SPEED": {
      "count": 26421.0,
      "mean": 71.88912455075592,
      "std": 41.953526316336244,
      "min": 0.0,
      "25%": 47.70833333333333,
      "50%": 66.5,
      "75%": 115.0,
      "max": 237.0
    },
    "ENGINE_LOAD": {
      "count": 22846.0,
      "mean": 23.956677902894523,
      "std": 18.168479737063144,
      "min": 0.0,
      "25%": 0.0,
      "50%": 26.2745098039216,
      "75%": 26.2745098039216,
      "max": 92.9411764705882
    }
  },
  "anomaly_stats_scaled_values": {
    "ENGINE_RPM": {
      "count": 26421.0,
      "mean": 1.2437502804766922,
      "std": 3.4205862343844324,
      "min": -1.7198694913150723,
      "25%": -0.27636576278969416,
      "50%": -0.10073478607339982,
      "75%": 0.4081026231046493,
      "max": 16.10702637631681
    },
    "ENGINE_COOLANT_TEMP": {
      "count": 25078.0,
      "mean": -2.4170756481486246,
      "std": 3.047190179374929,
      "min": -11.208639137851257,
      "25%": -5.784273266958994,
      "50%": -0.5608098357294086,
      "75%": 0.4939279724996424,
      "max": 11.392885324199836
    },
    "INTAKE_AIR_TEMP": {
      "count": 20558.0,
      "mean": -1.110966632773021,
      "std": 3.343111758474907,
      "min": -6.871261952384848,
      "25%": -3.256046626384456,
      "50%": -3.060629581735786,
      "75%": 4.51178089840017,
      "max": 15.113155570590509
    },
    "THROTTLE_POS": {
      "count": 26414.0,
      "mean": 0.7145271389524198,
      "std": 2.130462909980464,
      "min": -1.5232446750823938,
      "25%": -0.973626045264572,
      "50%": -0.10070233908332551,
      "75%": 1.3541705045520853,
      "max": 9.857094012910153
    },
    "VEHICLE_SPEED": {
      "count": 26421.0,
      "mean": 0.43273409408432884,
      "std": 1.0096256674036208,
      "min": -1.297301774804163,
      "25%": -0.14918474837854018,
      "50%": 0.30304300613495855,
      "75%": 1.47021175614319,
      "max": 4.4061826324525555
    },
    "ENGINE_LOAD": {
      "count": 22846.0,
      "mean": -0.827005940534851,
      "std": 1.3781818947165243,
      "min": -2.644255386891757,
      "25%": -2.644255386891757,
      "50%": -0.6511852881070402,
      "75%": -0.6511852881070402,
      "max": 4.405858246122827
    }
  }
}
2025-05-13 10:39:17,038 - INFO - --- End Anomaly Analysis Results ---
2025-05-13 10:39:17,327 - INFO - Saved DataFrame with anomaly predictions to: /home/alinmiron/ZedProjects/carsense-ml-service/data/processed/combined_general_tier1_test_on_volvo_raw_pids_predictions.parquet
2025-05-13 10:39:17,327 - INFO - --- Tier 1 Anomaly Model Testing Finished ---
